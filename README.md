# ActivityElement

> A small Web Component framework for creating web apps using a workflow-first
> and user-centric approach. The goal is to work at a higher abstraction layer
> than *Components* but low enough to use the programming language directly
> rather than, as with
> [ZjsComponent](https://github.com/lelanthran/ZjsComponent), a declarative
> process.

> Note that all the documentation (including this) was autogenerated by one or
> more LLMs. The code, however, is all mine.

**ActivityElement** transforms how you build modular web applications by
allowing you to dynamically load and manage remote activities
(mini-applications) with a simple intent-based API. Perfect for
micro-frontends, plugin systems, and modular app architectures.

## Quick Start

### 1. Register an Activity

```javascript
// Register a remote calculator activity
ActivityElement.intentRegister('calculator', document.body, 'https://myapp.com/activities/calculator.actv');
```

### 2. Launch the Activity

```javascript
const activity = await ActivityElement.intentStart('calculator', {
  initialValue: 100
});

const result = await activity.result;

if (result.status === 'completed') {
  console.log('User calculated:', result.value); // { answer: 250 }
}
```

### 3. Create a Remote Activity

```html
<!-- calculator.actv -->
<div class="calculator">
  <input id="display" type="number" value="0">
  <button onclick="addTen()">+10</button>
  <button onclick="finish()">Done</button>
</div>

<script>
exports.onCreate = (activity, params) => {
  document.getElementById('display').value = params.initialValue || 0;
};

function addTen() {
  const display = document.getElementById('display');
  display.value = parseInt(display.value) + 10;
}

function finish() {
  const answer = parseInt(document.getElementById('display').value);
  activity.finish({ answer });
}
</script>
```

## Why ActivityElement?

### Traditional Approach Problems

- Tightly coupled components
- Large bundle sizes
- All components loaded upfront
- Hard to update individual features
- No isolation between components

```javascript
import Calculator from './components/Calculator';
import UserProfile from './components/UserProfile';
import PaymentForm from './components/PaymentForm';
```

### ActivityElement Solution

```javascript
ActivityElement.intentRegister('calculator', document.body, '/activities/calc.actv');
ActivityElement.intentRegister('profile', document.body, '/activities/profile.actv');
ActivityElement.intentRegister('payment', document.body, '/activities/payment.actv');

const calc = await ActivityElement.intentStart('calculator');
```

## Core Features

- Plugin Architecture
- Intent-Based Routing
- Promise-Based API
- Cancellation Support
- Automatic Cleanup
- Isolated Execution
- Zero Dependencies

## Use Cases

### Micro-Frontend Architecture

```javascript
ActivityElement.intentRegister('checkout', document.body, 'https://payments.myapp.com/checkout.actv');
ActivityElement.intentRegister('analytics', document.body, 'https://analytics.myapp.com/dashboard.actv');
ActivityElement.intentRegister('support', document.body, 'https://support.myapp.com/chat.actv');

const checkout = await ActivityElement.intentStart('checkout', {
  items: cartItems,
  total: 99.99
});
```

### Plugin System

```javascript
const plugins = await fetchUserPlugins();
plugins.forEach(plugin => {
  ActivityElement.intentRegister(plugin.name, document.body, plugin.url);
});

const pluginResult = await ActivityElement.intentStart('user-plugin-name');
```

### Modal/Dialog Management

```javascript
const dialog = document.getElementById('dialog-container');
const activity = await ActivityElement.intentStart('confirmation-dialog', {
  title: 'Delete Item',
  message: 'Are you sure you want to delete this item?',
  buttons: ['Cancel', 'Delete']
}, { container: dialog });

const result = await activity.result;
if (result.status === 'completed' && result.value === 'Delete') {
  deleteItem();
}
```

### A/B Testing & Feature Flags

```javascript
const variant = getABTestVariant();
ActivityElement.intentRegister('signup-form', document.body, `/activities/signup-${variant}.actv`);

const signupResult = await ActivityElement.intentStart('signup-form');
```

## Real-World Example

```javascript
ActivityElement.intentRegister('task-list', document.body, '/activities/task-list.actv');
ActivityElement.intentRegister('task-editor', document.body, '/activities/task-editor.actv');
ActivityElement.intentRegister('settings', document.body, '/activities/settings.actv');

class TaskApp {
  async showTasks() {
    const taskList = await ActivityElement.intentStart('task-list');
    const result = await taskList.result;

    if (result.status === 'completed' && result.value.action === 'edit') {
      return this.editTask(result.value.taskId);
    }
  }

  async editTask(taskId) {
    const editor = await ActivityElement.intentStart('task-editor', { taskId });
    const result = await editor.result;

    if (result.status === 'completed') {
      return this.showTasks();
    }
  }

  async openSettings() {
    await ActivityElement.intentStart('settings');
  }
}
```

## Installation

Just copy the `ActivityElement` class into your project.

## API Overview

### Registration

```javascript
ActivityElement.intentRegister(intentName, container, source);
```

### Launching

```javascript
const activity = await ActivityElement.intentStart(intentName, params, options);
const result = await activity.result;
```

### Activity Lifecycle (inside remote activities)

```javascript
activity.finish(returnValue);
activity.cancel('user cancelled');
activity.fail(new Error('something went wrong'));
activity.onCancel(reason => cleanup());
```

## Creating Activities

```html
<!-- my-activity.actv -->
<div class="my-ui">
  <h1>Hello from Activity!</h1>
  <button onclick="complete()">Finish</button>
</div>

<script>
exports.onCreate = (activity, params) => {
  console.log('Activity started with:', params);
};

exports.onDestroy = (activity) => {
  console.log('Cleaning up...');
};

function complete() {
  activity.finish({ success: true });
}
</script>
```

## Advanced Features

### Cancellation Handling

```javascript
const longTask = await ActivityElement.intentStart('data-processing', { dataset: largeDataset });

setTimeout(() => longTask.cancel('timeout'), 30000);

const result = await longTask.result;
if (result.status === 'cancelled') {
  console.log('Task was cancelled:', result.reason);
}
```

### Custom Containers

```javascript
const modal = document.getElementById('modal-container');
const activity = await ActivityElement.intentStart('user-form', {}, { container: modal });
```

### Error Handling

```javascript
try {
  const activity = await ActivityElement.intentStart('risky-activity');
  const result = await activity.result;
} catch (error) {
  console.error('Activity failed:', error);
}
```

